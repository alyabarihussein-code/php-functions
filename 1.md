# حلول مقترحة لأسئلة أمن تطبيقات الويب

## س1: لماذا لا يُصنف هجوم CSRF كعملية اختراق مباشرة للموقع؟
يعتمد هجوم **تزوير الطلب عبر المواقع (CSRF)** بشكل أساسي على استغلال **العلاقة الائتمانية** القائمة بين خادم الويب ومتصفح المستخدم. في هذا النوع من الهجمات، لا يحتاج المهاجم لاختراق قاعدة البيانات أو كسر التشفير، بل يقوم بما يلي:
*   استدراج الضحية لزيارة رابط أو صفحة ملغومة.
*   يقوم المتصفح تلقائياً بإرفاق ملفات تعريف الارتباط (**Cookies**) الخاصة بالموقع المستهدف مع الطلب الخبيث.
*   يتعامل الموقع مع الطلب على أنه شرعي تماماً لأنه صادر من متصفح مستخدم مسجل الدخول بالفعل.

> **مثال توضيحي:** تخيل وجود نموذج مخفي في صفحة مشبوهة يقوم بإرسال طلب تحويل أموال إلى `bank.com`. بمجرد فتح الصفحة، يرسل المتصفح طلب POST مع جلسة المستخدم النشطة، ويتم التحويل دون علم المستخدم.

---

## س2: هل تكفي إدارة الجلسات (Sessions) وحدها لتأمين التطبيق؟
بالتأكيد لا، فالجلسات هي وسيلة للتعرف على المستخدم وليست درعاً شاملاً. هناك ثغرات تتجاوز مجرد وجود جلسة نشطة، مثل:
1.  **هجمات CSRF:** التي تنفذ عمليات باسم المستخدم رغم وجود جلسة صحيحة.
2.  **تثبيت الجلسة (Session Fixation):** حيث يفرض المهاجم معرف جلسة معين على الضحية.
3.  **غياب التحكم في الوصول (Broken Authorization):** فقد يكون المستخدم مسجلاً (Authenticated) ولكن يحاول الوصول لبيانات غير مخول له بها.

**الضوابط الأمنية المكملة:**
*   استخدام **CSRF Tokens** فريدة لكل طلب.
*   تفعيل خاصية **SameSite** لملفات تعريف الارتباط.
*   إجبار المستخدم على إعادة إدخال كلمة المرور عند تنفيذ عمليات حساسة.

---

## س3: مقارنة تحليلية بين ثغرتي CSRF و XSS
| وجه المقارنة | CSRF | XSS |
| :--- | :--- | :--- |
| **الهدف الأساسي** | تنفيذ إجراءات غير مصرح بها | سرقة بيانات أو تنفيذ أكواد برمجية |
| **مكان التنفيذ** | من موقع خارجي باتجاه الموقع المستهدف | داخل الموقع المستهدف نفسه |
| **المتطلب الأساسي** | وجود جلسة نشطة للمستخدم | وجود ضعف في معالجة المدخلات |
| **طريقة الوقاية** | الرموز الأمنية (Tokens) | تعقيم المدخلات وتشفير المخرجات |

---

## س4: لماذا يعتبر رفع الملفات من أخطر الثغرات الأمنية؟
تكمن خطورة رفع الملفات في أنها تمنح المهاجم القدرة على نقل **أكواد تنفيذية** مباشرة إلى الخادم. بدلاً من مجرد إرسال نصوص قد يتم تعقيمها، يمكن للمهاجم رفع "Web Shell" (مثل ملف PHP) يمنحه تحكماً كاملاً في نظام التشغيل، مما يؤدي إلى:
*   الوصول إلى ملفات النظام وقواعد البيانات.
*   استخدام الخادم كمنصة للهجوم على شبكات أخرى.
*   تعطيل الخدمة بالكامل (DoS).

---

## س5: كيف يمكن للمهاجم خداع الخادم لتنفيذ ملف صورة ككود برمجي؟
يحدث ذلك عندما يثق الخادم في **امتداد الملف** فقط أو يفشل في عزل مجلد التحميلات. الطرق الشائعة تشمل:
1.  **الامتدادات المزدوجة:** مثل `image.jpg.php`.
2.  **تغيير نوع المحتوى (MIME Type):** إرسال ملف PHP مع ترويسة تدعي أنه صورة.
3.  **حقن الأكواد في البيانات الوصفية:** وضع كود خبيث داخل بيانات EXIF للصورة ثم إجبار الخادم على معالجتها.

---

## س6: لماذا يوصف هجوم "Path Traversal" بأنه هجوم صامت؟
لأنه لا يتضمن عادةً رموزاً تثير ريبة أنظمة الحماية التقليدية (مثل `<script>` في XSS). الهجوم يبدو كطلب عادي لملف، ولكنه يستخدم تسلسلات مثل `../` للوصول إلى أدلة خارج نطاق الويب. 
*   يصعب اكتشافه في سجلات الخادم (Logs) إذا لم تكن هناك مراقبة دقيقة للمسارات الحقيقية.
*   يمكن تشفيره (URL Encoding) لتجاوز فلاتر الحماية البسيطة.

---

## س7: أهمية استخدام دالة `realpath()` في تأمين المسارات
تعمل دالة `realpath()` كفلتر نهائي للمسارات، حيث تقوم بـ:
*   تحويل المسارات النسبية (مثل `../`) إلى مسارات مطلقة ونهائية.
*   إزالة أي تلاعب في المسار قد يؤدي للخروج من المجلد المسموح به.
*   التأكد من وجود الملف فعلياً قبل محاولة معالجته.

---

## س8: استغلال "الثقة المفرطة" في المستخدمين
تعتمد العديد من الثغرات على افتراض المبرمج أن المستخدم سيتصرف دائماً بحسن نية. 
*   **في رفع الملفات:** الافتراض بأن المستخدم سيرفع صوراً فقط.
*   **في الصلاحيات:** الافتراض بأن المستخدم لن يغير معرفه (ID) في الرابط للوصول لبيانات غيره.
**القاعدة الذهبية:** "لا تثق أبداً في مدخلات المستخدم" (Never Trust User Input).

---

## س9: دور سمة `SameSite` في الحد من الهجمات
تعتبر سمة `SameSite` من أقوى الدفاعات الحديثة ضد CSRF، حيث تخبر المتصفح متى يجب إرسال الكوكيز:
*   **Strict:** لا يتم إرسال الكوكي إلا إذا كان الطلب من نفس الموقع تماماً.
*   **Lax:** يسمح بإرسال الكوكي في طلبات التنقل العادية (GET) فقط، مما يوفر توازناً بين الأمان وسهولة الاستخدام.

---

## س10: سيناريو التحول من "رفع ملف" إلى "اختراق كامل للنظام"
1.  **الرفع:** ينجح المهاجم في رفع ملف `backdoor.php` متجاوزاً الفلاتر.
2.  **التنفيذ:** يصل للملف عبر المتصفح ويبدأ بتنفيذ أوامر النظام (`ls`, `whoami`).
3.  **التصعيد:** يبحث عن ملفات التكوين (`config.php`) للحصول على كلمات مرور قاعدة البيانات.
4.  **السيطرة:** ينشئ اتصالاً عكسياً (Reverse Shell) للتحكم في الخادم من جهازه الخاص، ومن ثم الوصول للشبكة الداخلية.
