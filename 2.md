# تقرير حول مخاطر وعواقب الثغرات الأمنية في تطبيقات الويب

## أولاً: مخاطر غياب رموز الحماية (CSRF Tokens)
يؤدي تجاهل استخدام رموز CSRF إلى فتح ثغرة أمنية خطيرة تسمح للمهاجمين بتنفيذ عمليات نيابة عن المستخدمين. 
*   **الأثر المباشر:** فقدان السيطرة على حسابات المستخدمين وتنفيذ تحويلات مالية أو تغيير كلمات المرور دون علمهم.
*   **مثال:** استغلال جلسة مستخدم نشطة في موقع بنكي لإرسال طلب تحويل مخفي عبر صفحة خارجية ملغومة.

---

## ثانياً: عواقب قبول امتدادات الملفات غير المقيدة
السماح برفع أي نوع من الملفات هو بمثابة دعوة مفتوحة للمخترقين للسيطرة على الخادم.
*   **التهديد:** رفع ملفات برمجية (مثل `.php`, `.aspx`, `.py`) وتنفيذها مباشرة.
*   **النتيجة:** الحصول على "Web Shell" يتيح للمهاجم تصفح ملفات النظام، سرقة قواعد البيانات، أو حتى مسح محتويات الخادم بالكامل.

---

## ثالثاً: مخاطر الاحتفاظ بأسماء الملفات الأصلية عند الرفع
تخزين الملفات بأسمائها التي اختارها المستخدم يفتح الباب لعدة هجمات:
1.  **تجاوز المسارات (Path Traversal):** استخدام أسماء مثل `../../../etc/passwd` لمحاولة استبدال ملفات النظام.
2.  **تضارب البيانات:** استبدال ملفات هامة موجودة مسبقاً على الخادم إذا تشابهت الأسماء.
3.  **حقن الأوامر:** تضمين رموز برمجية أو أوامر نظام داخل اسم الملف.

---

## رابعاً: التهديدات الناتجة عن إهمال دالة `realpath()`
بدون استخدام `realpath()`، يظل التطبيق عرضة لهجمات الوصول غير المصرح به للملفات.
*   **المشكلة:** عدم قدرة التطبيق على تمييز المسارات الحقيقية من المسارات المتلاعب بها (مثل استخدام `..`).
*   **الخطر:** تمكين المهاجم من قراءة ملفات حساسة مثل ملفات الإعدادات (`.env`, `config.php`) التي تحتوي على كلمات مرور قواعد البيانات.

---

## خامساً: خطورة وضع مجلد التحميلات داخل المجلد العام (Public Root)
يعتبر هذا الخطأ من أشهر أخطاء التكوين الأمني، حيث:
*   يسمح للمتصفح بالوصول المباشر لأي ملف مرفوع وتنفيذه.
*   يجعل من السهل على المهاجم تشغيل الأكواد الخبيثة بمجرد معرفة رابط الملف.
*   **الحل الأمثل:** تخزين الملفات خارج مجلد الويب العام وتقديمها للمستخدم عبر وسيط برمجي يتحقق من الصلاحيات ونوع الملف.

---

## ملخص التوصيات الأمنية:
1.  تفعيل **CSRF Tokens** و **SameSite Cookies** كخط دفاع أول.
2.  تطبيق سياسة **القائمة البيضاء (Whitelist)** للامتدادات المسموح بها فقط.
3.  تغيير أسماء الملفات المرفوعة إلى أسماء عشوائية (مثل UUID).
4.  استخدام **realpath()** للتحقق من سلامة المسارات قبل المعالجة.
5.  عزل مجلد التحميلات تماماً عن جذر الويب العام وتعطيل تنفيذ السكريبتات فيه.
